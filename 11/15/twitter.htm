<!DOCTYPE html>
<html>
<head>
<title>title</title>
<meta charset="UTF-8" />
<style>
body{
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function(event) { 
  console.log( 'DOMContentLoaded' );
  var jsElm = document.createElement("script");
  jsElm.type = "application/javascript";
  jsElm.src = 'https://code.jquery.com/jquery-3.3.1.min.js';
  jsElm.onload = function(e){
    console.log('jsElm.onload');
	//id01.insertAdjacentHTML('afterbegin', 'jqueryè®€å–æˆåŠŸ');
	poi();
  };
  //document.body.appendChild(jsElm);
  document.head.appendChild(jsElm);
});//DOMContentLoaded

function poi(){

	//
	$(document).ready(function() {
		console.log('document.ready');
		time = new Date();
		//
		poi_ajax();
		//poi();
		poi2();
	});//document).ready

}//poi()

function poi_ajax(){ //æ²’ç”¨åˆ°
  var cc1=0;
  var cc2=0;
  $( document ).ajaxStart(function() {
    //
  });
  $(document).ajaxComplete(function(event, xhr, settings ) { // event, xhr, settings
    cc1++;
    //console.log( event, xhr, settings  );
  });
  $(document).ajaxStop(function() {
    cc2++;
  });
}//poi_ajax()
//poi_ajax()


function poi2(){
	var qq=$("pre").text();
	$("pre").html("<b>è®€å–æ¸¬è©¦</b>");
	qq=qq.replace(/\r\n/g, "\n");
	qq=qq.split("\n");
	qq=qq.filter(Boolean);
	//console.log( qq );
	var url_array=[];
	var url_array2=[];
	for(i=0;i<qq.length;i++){
		//console.log( qq[i] );
		var aa=poi2b( qq[i] ); //æª¢æŸ¥ç¶²å€
		//console.log( aa[1] ); //å›å‚³å¸¶iç¶²å€
		if(url_array.includes( aa[1] )){
			//æœ‰=é‡è¤‡
			//console.log( 'é‡è¤‡id' );
		}else{
			//ç„¡=æ–°çš„
			url_array.push( aa[1] );//id
			url_array2.push( aa[0] );//url
		}
	}
	//console.log( url_array );
	//console.log( url_array2 );
	//console.log( 'for loop finish' );
	//poi3(qq,0); //ajaxè™•ç†ç¶²å€
	poi3(url_array2,0); //ajaxè™•ç†ç¶²å€
}//poi2()
//
function poi2b(in1){//æª¢æŸ¥ç¶²å€
	//console.log( in1 );//ç¶²å€
	var url= in1;
	//
	var cc=0;
	var chk=url.includes("twitter.com");
	if(chk){
		//y
		//ç¶²å€è¦åŒ…å«twitter.com
	}else{
		//n
		cc++;
	}
	//
	var re = /status\/([0-9]{15,20})/;
	var res = url.match(re);
	if(res){
		//y
		//ç¶²å€è¦åŒ…å«ä¸€ä¸²æ•¸å­—
	}else{
		//n
		cc++;
	}
	//
	if(cc>0){
		//é©—è­‰å¤±æ•—
		url=0;
	}else{
		url="https://twitter.com/i/status/"+res[1];
	}
	//
	var x=[];
	x[0]=url;
	x[1]=res[1];
	return x;
	
}//poi2b()
//poi2b()

function poi3(qq,pp){  //æ­¥é€²é¡¯ç¤º
	//console.log( qq[pp] );

	//å»ºç«‹å€‹åˆ¥box
	var str1 = "box"+pp;
	//var str2 = '<div id="'+str1+'">&emsp;'+pp+'</div>';
	//var str2 = '<div id="'+str1+'">&emsp;ğŸ”°&ensp;'+qq[pp]+'</div>';
	var str2 = '<div id="'+str1+'">&emsp;ğŸ”°&ensp;'+pp+'</div>';
/*
&ZeroWidthSpace;
&zwnj;
&nbsp;  ä¸€èˆ¬ç©ºæ ¼

&ensp;  åŠå½¢ç©ºæ ¼
&emsp;  å…¨å½¢ç©ºæ ¼

https://emojipedia.org/symbols/
https://developer.wordpress.com/docs/photon/api/
https://i2.wp.com/pbs.twimg.com/media/EFSeU3yVAAAn1J1.jpg?fit=2048,2048


*/
	$("#ddd").append( str2 );
	var str3=$("#"+ str1 +"");
	//console.log( str1,str3 );

	//æª¢æŸ¥ç¶²å€
	var url=''+qq[pp];
//////
try{
	var url2 = new URL(url);
	//console.log( url2 );
}
catch(err){
	//è§£è®€ç¶²å€å¤±æ•—
	console.log( 'è§£è®€ç¶²å€å¤±æ•—' );
	poi4(qq,pp);//é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
	return;
}
finally{}	
//////
	//console.log( url2 );
	//console.log( url2.pathname );
	
	
	
	
	//æª¢æŸ¥ç¶²å€//
	//å–å¾—oembedå…§å®¹
	var jqxhr =$.ajax({
	type:     "GET",
	url:      "https://publish.twitter.com/oembed?url="+url,
	dataType: "jsonp",
	success: function(data,status,jqxhr){
		$("#box"+pp ).append( $(data.html)[0] );
		//$("pre").html("<b>("+pp+"/"+qq.length+") "+ status +" "+qq[pp]+"</b>");
	},
	error: function(){
			//your code here
	},
	complete:function(data){
		//console.log( pp,qq.length,qq[pp] );
		//è®€å–å®Œ å°±è®€å–æ¨ç‰¹js
		//ajaxè£¡çš„æ±è¥¿æœƒå»¶é²åŸ·è¡Œ
		if(pp<(qq.length-1)){
			//pp++;
			//poi3(qq,pp);
		}else{
			poi_getjs();//è®€å–å®Œ å°±è®€å–æ¨ç‰¹js
		}
		//
		
	},
	});//ajax
	
	
	jqxhr.done(function(a,b,c){//data,status,jqxhr
		//console.log( a,b,c );
		//console.log( pp,qq.length,qq[pp] );
		$("pre").html("<b>("+pp+"/"+qq.length+") "+b+" "+qq[pp]+"</b>"); //è¼ƒæ…¢
		//console.log( 'jqxhr.done' );
	});
	jqxhr.fail(function(a,b,c){
		$("pre").html("<b>("+pp+"/"+qq.length+") éŒ¯èª¤</b>");
		//console.log( a,b,c );
		throw "éŒ¯èª¤error";
		//throw new Error("éŒ¯èª¤error");
	});
	jqxhr.always(function(a,b,c){
		//ç¸½æ˜¯
	});
	
	
	//è™•ç†ä¸‹ä¸€å€‹
	if(pp<(qq.length-1)){
		poi4(qq,pp);//é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
	}else{
		//poi_getjs();
	}
	//

  
}//poi3
//poi3

function poi4(qq,pp){ //é¿å…ajaxå»¶é²è®€å–è®Šæ•¸
	pp++;
	poi3(qq,pp);
}//poi4()
//poi4()


//function poi0(){}

function poi_getjs(){
    var jqxhr=$.getScript("https://platform.twitter.com/widgets.js");
	jqxhr.done(function(){
    if(0){
      var id01=document.getElementById('ppp');
      //var id01=document.getElementsByTagName("pre")[0];
      id01.insertAdjacentHTML('beforebegin', 'beforebegin');
      id01.insertAdjacentHTML('afterbegin', 'afterbegin');
      id01.insertAdjacentHTML('beforeend', 'beforeend');
      id01.insertAdjacentHTML('afterend', 'afterend');
      //console.log( id01.outerHTML );
    }else{
      //$("pre").hide();
	  $("pre").html("å®Œæˆ"); //æ¸…æ‰äº†ç¶²å€
    }
    //
  });
}//poi_getjs()
//


  
  







</script>

	</head>
	<body>
	
<pre id="ppp">

https://twitter.com/mofnekoclub/status/1194846462825205760
https://twitter.com/Pg45FAVaoi6lRid/status/1194902451070963712

</pre>

<div id="ddd"></div>


	</body>
</html>
